<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JasPer: Configuration, Initialization, and Shutdown</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JasPer
   &#160;<span id="projectnumber">3.0.3</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('lib_init.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Configuration, Initialization, and Shutdown </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="lib_init__api"></a>
API References</h1>
<ul>
<li><a class="el" href="group__module__init.html">Configuration, Initialization, and Shutdown</a></li>
</ul>
<h1><a class="anchor" id="init_overview"></a>
Configuration, Initialization, and Shutdown</h1>
<p>There are three stages in the setup of the JasPer library at run time:</p>
<ol type="1">
<li>configuration;</li>
<li>global (i.e., library-wide) initialization; and</li>
<li>per-thread initialization.</li>
</ol>
<p>These stages of setup are performed in the order listed. Aside from the exceptions noted in this section, code in the JasPer library must not be invoked by a thread prior to per-thread initialization being performed by that thread. Only the following functions may be called prior to the configuration of the JasPer library (via <code><a class="el" href="group__module__init.html#ga9594694b0d16f148affda325971cbd81" title="Configure the JasPer library with the default configuration settings.">jas_conf_clear()</a></code>):</p>
<ul>
<li><code><a class="el" href="group__module__alloc.html#gad55f815881983ba732b3125d94a24f52" title="Get the total amount of memory available on the system.">jas_get_total_mem_size()</a></code></li>
</ul>
<p>The configuration stage initializes the current (run-time) configuration settings for the library. First, the configuration settings are initialized to their default values using the <code><a class="el" href="group__module__init.html#ga9594694b0d16f148affda325971cbd81" title="Configure the JasPer library with the default configuration settings.">jas_conf_clear()</a></code> function (where these default values are fixed at the time that the library is built). Then, configuration settings may be changed from their defaults (prior to global initialization), if so desired. The following functions may be called after the JasPer library is configured (via <code><a class="el" href="group__module__init.html#ga9594694b0d16f148affda325971cbd81" title="Configure the JasPer library with the default configuration settings.">jas_conf_clear()</a></code>) but before global initialization is performed (via <code><a class="el" href="group__module__init.html#gaefb16e8a208c87feb3de8b29a818f498" title="Initialize the JasPer library with the current configuration settings.">jas_init_library()</a></code>):</p>
<ul>
<li>the <code>jas_conf_*</code> family of functions, including functions such as:<ul>
<li><code><a class="el" href="group__module__init.html#ga9594694b0d16f148affda325971cbd81" title="Configure the JasPer library with the default configuration settings.">jas_conf_clear()</a></code></li>
<li><code><a class="el" href="group__module__init.html#ga4115aec35dd0e2105605243215782f36" title="Set the multithreading flag for the library.">jas_conf_set_multithread()</a></code></li>
<li><code><a class="el" href="group__module__init.html#ga3aa0c3964eea8013a1a8b3f43fd0dc05" title="Set the memory allocator to be used by the library.">jas_conf_set_allocator()</a></code></li>
<li><code><a class="el" href="group__module__init.html#gadc8494e5b56c5a2d3faf5e5a0dca344c" title="Set the initial debug level for the library.">jas_conf_set_debug_level()</a></code></li>
<li><code><a class="el" href="group__module__init.html#ga8358834a376f77d743041d16fc444d68" title="Set the maximum amount of memory that can be used by the library (assuming the allocator wrapper is n...">jas_conf_set_max_mem_usage()</a></code></li>
<li><code><a class="el" href="group__module__init.html#ga78dcf403baa8aba7a83114cfd3be496d" title="Set the default value for the maximum number of samples that is allowed in an image to be decoded.">jas_conf_set_dec_default_max_samples()</a></code></li>
<li><code><a class="el" href="group__module__init.html#ga1a0977992f4f9cd7f6a0dcc752f0186a" title="Set the function used by the library to output error, warning, and informational messages.">jas_conf_set_vlogmsgf()</a></code></li>
</ul>
</li>
<li><code><a class="el" href="group__module__alloc.html#ga5e90c6c7096fdeeda09e2dcde6c4b4c5" title="Initialize a memory allocator that uses malloc and related functions for managing memory.">jas_std_allocator_init()</a></code></li>
</ul>
<p><b>In order to use JasPer in multiple threads, the multithread flag must be set (to true) during configuration using the <code><a class="el" href="group__module__init.html#ga4115aec35dd0e2105605243215782f36" title="Set the multithreading flag for the library.">jas_conf_set_multithread()</a></code> function.</b></p>
<p>The global initialization stage initializes the library itself using the current configuration settings. The <code><a class="el" href="group__module__init.html#gaefb16e8a208c87feb3de8b29a818f498" title="Initialize the JasPer library with the current configuration settings.">jas_init_library()</a></code> function performs global initialization (but not configuration). After global initialization is performed, per-thread initialization can then be performed.</p>
<p>The per-thread initialization stage performs any initialization necessary in order to allow a thread to use the library. The <code><a class="el" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb" title="Perform per-thread initialization for the JasPer library.">jas_init_thread()</a></code> function performs per-thread initialization. Per-thread initialization cannot be performed until after global initialization. After a thread performs per-thread initialization, it is free to use the full API of the library. Aside from the exceptions noted in this section, no function in the library may be invoked by a thread prior to it performing per-thread initialization via <code><a class="el" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb" title="Perform per-thread initialization for the JasPer library.">jas_init_thread()</a></code>. Per-thread initialization (via <code><a class="el" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb" title="Perform per-thread initialization for the JasPer library.">jas_init_thread()</a></code>) can be performed at any point during the lifetime of a thread (not necessarily at the start of the thread's lifetime), subject to the constraint that the thread must not use any macros/functions in the JasPer library that require per-thread initialization to have been performed prior to calling <code><a class="el" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb" title="Perform per-thread initialization for the JasPer library.">jas_init_thread()</a></code>.</p>
<p>The shutdown of the library roughly mirrors the process for library setup and consists of the following two stages:</p>
<ol type="1">
<li>per-thread clean-up</li>
<li>global (i.e., library-wide) clean-up</li>
</ol>
<p>Each thread that has performed per-thread initialization must perform per-thread clean-up prior to global clean-up. Per-thread clean-up is performed by invoking the <code><a class="el" href="group__module__init.html#ga86eb369e542789b63b7af5212fd790de" title="Perform per-thread cleanup for the JasPer library.">jas_cleanup_thread()</a></code> function. Global clean-up is performed by invoking the <code><a class="el" href="group__module__init.html#ga0cadef06bb0bf90a5f62c65a40aee590" title="Perform clean up for the JasPer library.">jas_cleanup_library()</a></code> function.</p>
<p>The library cannot be re-initialized (without first being cleaned up). That is, calling <code><a class="el" href="group__module__init.html#gaefb16e8a208c87feb3de8b29a818f498" title="Initialize the JasPer library with the current configuration settings.">jas_init_library()</a></code> more than once without an intervening call to <code><a class="el" href="group__module__init.html#ga0cadef06bb0bf90a5f62c65a40aee590" title="Perform clean up for the JasPer library.">jas_cleanup_library()</a></code> is not allowed. Note, however, that a program can call <code><a class="el" href="group__module__init.html#gaefb16e8a208c87feb3de8b29a818f498" title="Initialize the JasPer library with the current configuration settings.">jas_init_library()</a></code> more than once, provided that the program makes an intervening call to <code><a class="el" href="group__module__init.html#ga0cadef06bb0bf90a5f62c65a40aee590" title="Perform clean up for the JasPer library.">jas_cleanup_library()</a></code>. Similarly, a thread cannot be re-initialized (without first being cleaned up). That is, calling <code><a class="el" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb" title="Perform per-thread initialization for the JasPer library.">jas_init_thread()</a></code> more than once without an intervening call to <code><a class="el" href="group__module__init.html#ga86eb369e542789b63b7af5212fd790de" title="Perform per-thread cleanup for the JasPer library.">jas_cleanup_thread()</a></code> is not allowed. Note, however, that a thread can call <code><a class="el" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb" title="Perform per-thread initialization for the JasPer library.">jas_init_thread()</a></code> more than once, provided that the thread makes an intervening call to <code><a class="el" href="group__module__init.html#ga86eb369e542789b63b7af5212fd790de" title="Perform per-thread cleanup for the JasPer library.">jas_cleanup_thread()</a></code>.</p>
<p>Configuration, global initialization, and global clean-up should be performed on the same thread. That is, <code><a class="el" href="group__module__init.html#ga9594694b0d16f148affda325971cbd81" title="Configure the JasPer library with the default configuration settings.">jas_conf_clear()</a></code>, <code><a class="el" href="group__module__init.html#gaefb16e8a208c87feb3de8b29a818f498" title="Initialize the JasPer library with the current configuration settings.">jas_init_library()</a></code>, and <code><a class="el" href="group__module__init.html#ga0cadef06bb0bf90a5f62c65a40aee590" title="Perform clean up for the JasPer library.">jas_cleanup_library()</a></code> must all be called from the same thread.</p>
<p>For backward-compatibility with older versions of the library, the <code><a class="el" href="group__module__init.html#ga5600bbf6d5dcd8cc18bc5f307d289a8c" title="Configure and initialize the JasPer library using the default configuration settings.">jas_init()</a></code> and <code><a class="el" href="group__module__init.html#ga108e7187b1d5b03652bab9d9f903de30" title="Perform any clean up for the JasPer library.">jas_cleanup()</a></code> functions may also be used for library setup and shutdown. These function have been marked as deprecated, and will be removed in a future version of the library. Also, if these functions are used, JasPer cannot be employed in more than one thread and library configuration parameters cannot be changed from their defaults. The <code><a class="el" href="group__module__init.html#ga5600bbf6d5dcd8cc18bc5f307d289a8c" title="Configure and initialize the JasPer library using the default configuration settings.">jas_init()</a></code> function can be used (by legacy code) to perform configuration, global initialization, and per-thread initialization for the calling thread. The <code><a class="el" href="group__module__init.html#ga5600bbf6d5dcd8cc18bc5f307d289a8c" title="Configure and initialize the JasPer library using the default configuration settings.">jas_init()</a></code> function internally calls <code><a class="el" href="group__module__init.html#ga9594694b0d16f148affda325971cbd81" title="Configure the JasPer library with the default configuration settings.">jas_conf_clear()</a></code> to initialize the configuration settings with their default values, and then invokes <code><a class="el" href="group__module__init.html#gaefb16e8a208c87feb3de8b29a818f498" title="Initialize the JasPer library with the current configuration settings.">jas_init_library()</a></code> and <code><a class="el" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb" title="Perform per-thread initialization for the JasPer library.">jas_init_thread()</a></code>. Similarly, <code><a class="el" href="group__module__init.html#ga108e7187b1d5b03652bab9d9f903de30" title="Perform any clean up for the JasPer library.">jas_cleanup()</a></code> can be used (by legacy code) to perform per-thread cleanup for the calling thread and global cleanup.</p>
<h1><a class="anchor" id="init__state"></a>
Library State</h1>
<p>The JasPer library has the notion of a context. A context is used to store certain state used by the library. There can be multiple contexts in use at any given time. From the library user's point of view, a context is specified using an opaque handle. The type of this handle is <code>jas_context_t</code>. A handle with the special value of 0 does not correspond to a valid context. It is analogous to a null pointer.</p>
<p>The JasPer library allows the current context to be set independently for each thread. That is, the current context is a per-thread setting. When a thread is initialized, a single context is automatically created, which is referred to as the default context, and the current context for the thread is set to this default context. A context cannot be shared by more than one thread, as this would lead to data races and other synchronization problems.</p>
<p>The JasPer library has two types of state:</p>
<ol type="1">
<li>Global state. That is, state that is library wide.</li>
<li>Per-context state. That is, state that only applies to a particular context.</li>
</ol>
<p>Most state maintained by the library is in the form of per-context state. This is motivated by the desire to minimize the sharing of state between threads, which would require locking/synchronization. The global state for the library includes:</p>
<ul>
<li>the memory allocator to be used by the library</li>
<li>the maximum amount of memory that the library is permitted to use</li>
<li>certain configuration settings that are used as default values when creating/initializing contexts</li>
</ul>
<p>The per-context state includes:</p>
<ul>
<li>the debug level</li>
<li>the vlogmsgf function to be used for logging error/warning/informational messages</li>
<li>the image format table</li>
<li>the maximum number of samples in an image that a decoder is allowed to process</li>
</ul>
<h1><a class="anchor" id="init__contexts"></a>
Contexts</h1>
<p>Contexts can be created and destroyed with the following functions:</p>
<ul>
<li><code><a class="el" href="group__module__init.html#ga315e2f37f1b918f98b373a69643277d7" title="Create a context.">jas_context_create()</a></code></li>
<li><code><a class="el" href="group__module__init.html#gaca350e3129a93371a743f9c5f86923e8" title="Destroy a context.">jas_context_destroy()</a></code></li>
</ul>
<p>The current context for the calling thread can be set/queried with the following functions:</p>
<ul>
<li><code><a class="el" href="group__module__init.html#ga01f776425cca5fbfa2e99dfd3dbe842f" title="Get the current context for the calling thread.">jas_get_context()</a></code></li>
<li><code><a class="el" href="group__module__init.html#gaec624e182df8bb9257850deb96bcad84" title="Set the current context for the calling thread.">jas_set_context()</a></code></li>
</ul>
<p>The various per-context settings can be set/queried with the following functions:</p>
<ul>
<li><code><a class="el" href="group__module__init.html#ga1f340a8c4288c38602872f9a2a6d8a83" title="Set the debug level for a particular context.">jas_set_debug_level()</a></code></li>
<li><code><a class="el" href="group__module__init.html#gacd299ae1ac0f84fa9e358900ec315df3" title="Get the debug level for a particular context.">jas_get_debug_level()</a></code></li>
<li><code><a class="el" href="group__module__init.html#ga5e663ba1fb984a30e253e9e37162ee35" title="Set the default maximum number of samples that a decoder is permitted to process.">jas_set_dec_default_max_samples()</a></code></li>
<li><code><a class="el" href="group__module__init.html#gad93156541b3f66c353eaecc2eb4ce9c1" title="Get the default maximum number of samples that a decoder is permitted to process.">jas_get_dec_default_max_samples()</a></code></li>
<li><code><a class="el" href="group__module__init.html#ga3dc431c6cb786e65e25fdb6d5046a7ad" title="Set the function to be used for log messages.">jas_set_vlogmsgf()</a></code></li>
<li><code><a class="el" href="group__module__init.html#ga1395d5a411d6295c1d6d9758e06aee75" title="Get the function to be used for log messages.">jas_get_vlogmsgf()</a></code></li>
</ul>
<h1><a class="anchor" id="init_setup_example_1"></a>
Example of Code for Library Setup and Shutdown</h1>
<p>Setup and shutdown of the library would typically be performed in the main thread of the application using code resembling the following:</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">Configure the library using the default configuration settings.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><a class="code" href="group__module__init.html#ga9594694b0d16f148affda325971cbd81">jas_conf_clear</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">Change any configuration parameters for which defaults are not suitable</span></div>
<div class="line"><span class="comment">by using the jas_conf_* family of functions.</span></div>
<div class="line"><span class="comment">An example of this type of code follows.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structjas__std__allocator__t.html">jas_std_allocator_t</a> allocator;</div>
<div class="line"><a class="code" href="group__module__alloc.html#ga5e90c6c7096fdeeda09e2dcde6c4b4c5">jas_std_allocator_init</a>(&amp;allocator);</div>
<div class="line"><a class="code" href="group__module__init.html#ga3aa0c3964eea8013a1a8b3f43fd0dc05">jas_conf_set_allocator</a>(JAS_CAST(std_allocator_t *, &amp;allocator));</div>
<div class="line"><a class="code" href="group__module__init.html#ga8358834a376f77d743041d16fc444d68">jas_conf_set_max_mem_usage</a>(10000000);</div>
<div class="line"><a class="code" href="group__module__init.html#ga4115aec35dd0e2105605243215782f36">jas_conf_set_multithread</a>(<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">Perform global initialization for the JasPer library.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__module__init.html#gaefb16e8a208c87feb3de8b29a818f498">jas_init_library</a>()) {</div>
<div class="line">        <span class="comment">/* Handle the initialization error. */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">Perform any per-thread initialization for the JasPer library.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb">jas_init_thread</a>()) {</div>
<div class="line">        <span class="comment">/* Handle the initialization error. */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">Use the JasPer library.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Perform any per-thread clean-up for the JasPer library. */</span></div>
<div class="line"><a class="code" href="group__module__init.html#ga86eb369e542789b63b7af5212fd790de">jas_cleanup_thread</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Perform global cleanup for the JasPer library. */</span></div>
<div class="line"><a class="code" href="group__module__init.html#ga0cadef06bb0bf90a5f62c65a40aee590">jas_cleanup_library</a>();</div>
</div><!-- fragment --><p>In the case of an application where the JasPer library is used in more than one thread, each additional thread would need to perform per-thread initialization (via <code><a class="el" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb" title="Perform per-thread initialization for the JasPer library.">jas_init_thread()</a></code>) before using the library. Also, each additional thread would need to perform per-thread cleanup (via <code><a class="el" href="group__module__init.html#ga86eb369e542789b63b7af5212fd790de" title="Perform per-thread cleanup for the JasPer library.">jas_cleanup_thread()</a></code>) when the use of the library is no longer needed. For each thread, the code for this might resemble something like the following:</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">Perform any per-thread initialization for the JasPer library.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb">jas_init_thread</a>()) {</div>
<div class="line">        <span class="comment">/* Handle the initialization error. */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">Use the JasPer library.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Perform any per-thread clean-up for the JasPer library. */</span></div>
<div class="line"><a class="code" href="group__module__init.html#ga86eb369e542789b63b7af5212fd790de">jas_cleanup_thread</a>();</div>
</div><!-- fragment --><p>When practical, it is probably preferable (for reasons of efficiency) to invoke <code><a class="el" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb" title="Perform per-thread initialization for the JasPer library.">jas_init_thread()</a></code> and <code><a class="el" href="group__module__init.html#ga86eb369e542789b63b7af5212fd790de" title="Perform per-thread cleanup for the JasPer library.">jas_cleanup_thread()</a></code> only once in the lifetime of a thread. In some cases, this may be difficult to do, due to the structure of the application code. In such situations, one could simply wrap code using the JasPer library in calls to <code><a class="el" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb" title="Perform per-thread initialization for the JasPer library.">jas_init_thread()</a></code> and <code><a class="el" href="group__module__init.html#ga86eb369e542789b63b7af5212fd790de" title="Perform per-thread cleanup for the JasPer library.">jas_cleanup_thread()</a></code>. As explained earlier, this is valid to do. For example, code like that shown in the example below is valid (assuming that the global initialization of the JasPer library has already been performed).</p>
<div class="fragment"><div class="line"><span class="comment">/* Code that does not use the JasPer library. */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Perform per-thread initialization of the JasPer library. */</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb">jas_init_thread</a>()) {</div>
<div class="line">    <span class="comment">/* Handle initialization error. */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Code that uses the JasPer library (e.g., performing encoding/decoding).</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/* Perform per-thread cleanup of the JasPer library. */</span></div>
<div class="line"><a class="code" href="group__module__init.html#ga86eb369e542789b63b7af5212fd790de">jas_cleanup_thread</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Code that does not use the JasPer library. */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Perform per-thread initialization of the JasPer library. */</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb">jas_init_thread</a>()) {</div>
<div class="line">    <span class="comment">/* Handle initialization error. */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Code that uses the JasPer library (e.g., performing encoding/decoding).</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/* Perform per-thread cleanup of the JasPer library. */</span></div>
<div class="line"><a class="code" href="group__module__init.html#ga86eb369e542789b63b7af5212fd790de">jas_cleanup_thread</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Code that does not use the JasPer library. */</span></div>
</div><!-- fragment --><h1><a class="anchor" id="init_setup_example_3"></a>
Additional Examples of Library Setup</h1>
<p>Some additional examples of using the <code><a class="el" href="group__module__init.html#ga9594694b0d16f148affda325971cbd81" title="Configure the JasPer library with the default configuration settings.">jas_conf_clear()</a></code>, <code><a class="el" href="group__module__init.html#gaefb16e8a208c87feb3de8b29a818f498" title="Initialize the JasPer library with the current configuration settings.">jas_init_library()</a></code>, <code><a class="el" href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb" title="Perform per-thread initialization for the JasPer library.">jas_init_thread()</a></code>, <code><a class="el" href="group__module__init.html#ga86eb369e542789b63b7af5212fd790de" title="Perform per-thread cleanup for the JasPer library.">jas_cleanup_thread()</a></code>, and <code><a class="el" href="group__module__init.html#ga0cadef06bb0bf90a5f62c65a40aee590" title="Perform clean up for the JasPer library.">jas_cleanup_library()</a></code>, functions (as well as the <code><a class="el" href="group__module__init.html#ga5600bbf6d5dcd8cc18bc5f307d289a8c" title="Configure and initialize the JasPer library using the default configuration settings.">jas_init()</a></code> and <code><a class="el" href="group__module__init.html#ga108e7187b1d5b03652bab9d9f903de30" title="Perform any clean up for the JasPer library.">jas_cleanup()</a></code> functions) can be found in the source code for the application programs <code>jasper</code>, <code>imginfo</code>, and <code>imgcmp</code>. Moreover, the application program <code>multithread</code> is an example of a program that uses the JasPer library in multiple threads.</p>
<h1><a class="anchor" id="init_allocators"></a>
Memory Allocators and the Allocator Wrapper</h1>
<p>The library provides a simple interface for memory allocators. This is provided through the <code>jas_allocator_t</code> type. An allocator object resides in memory managed by the library user. If the library user invokes <code><a class="el" href="group__module__init.html#ga0cadef06bb0bf90a5f62c65a40aee590" title="Perform clean up for the JasPer library.">jas_cleanup_library()</a></code> via <code>atexit()</code>, then the allocator should obviously not be allocated on the stack. (The <code><a class="el" href="group__module__init.html#ga0cadef06bb0bf90a5f62c65a40aee590" title="Perform clean up for the JasPer library.">jas_cleanup_library()</a></code> function will use the allocator in order to free memory previously allocated by the library.)</p>
<p>The <code><a class="el" href="group__module__alloc.html#ga5e90c6c7096fdeeda09e2dcde6c4b4c5" title="Initialize a memory allocator that uses malloc and related functions for managing memory.">jas_std_allocator_init()</a></code> function provides a way to create an allocator that uses <code>malloc()</code> and related functions from the C standard library.</p>
<p>The JasPer library does not directly use the allocator provided by the library user. It instead uses this allocator indirectly through a wrapper. The allocator wrapper is a pseudo-allocator. That is, it does not actually allocate memory directly but rather delegates the memory allocation operations to another allocator (namely, the one specified by the library user). The allocator wrapper tracks the amount of memory used by the allocator to which it delegates. This eliminates the need for the library user's allocator to track this information itself.</p>
<p>As long as the allocator wrapper functionality is enabled, the JasPer library will track how much memory is being used by the allocator in order to allow a limit to be imposed on memory usage. The allocator wrapper composes with the allocator selected by the library user, as explained above. So, this memory limiting functionality is available even when the library user provides a custom allocator that does not itself track memory usage.</p>
<p>Although <code><a class="el" href="group__module__alloc.html#ga05a218c866337130bb4840c44a18ff51" title="Allocate memory.">jas_malloc()</a></code>, <code><a class="el" href="group__module__alloc.html#gafb469aa5f472c555dd8ec1abd2f0c484" title="Resize a block of allocated memory.">jas_realloc()</a></code>, <code><a class="el" href="group__module__alloc.html#gaff1d0137fe319d3c6704b9e0f9c5583f" title="Free memory.">jas_free()</a></code> and other related functions internally use the allocator provided by the library user for all memory allocations, this does not imply that pointers returned by <code><a class="el" href="group__module__alloc.html#ga05a218c866337130bb4840c44a18ff51" title="Allocate memory.">jas_malloc()</a></code> (and related functions) can be used with the library user's allocator directly. For this reason, it is important to use the <code><a class="el" href="group__module__alloc.html#gaff1d0137fe319d3c6704b9e0f9c5583f" title="Free memory.">jas_free()</a></code> function to free memory allocated by <code><a class="el" href="group__module__alloc.html#ga05a218c866337130bb4840c44a18ff51" title="Allocate memory.">jas_malloc()</a></code> and friends (and not attempt to directly invoke the underlying custom allocator provided by the library user).</p>
<p>An allocator provides functions with the following signatures and semantics:</p>
<ul>
<li><p class="startli"><code>void (*cleanup)(jas_allocator_t *allocator);</code></p>
<p class="startli">This function performs a clean-up operation, which cleans up the allocator when it is no longer needed. This operation should free any resources associated with the allocator. The allocator cannot be used after the clean-up operation is performed. This function pointer may be null, in which case the clean-up operation is treated as a no-op.</p>
</li>
<li><p class="startli"><code>void *(*alloc)(jas_allocator_t *allocator, size_t size);</code></p>
<p class="startli">This function performs a memory-allocation operation, and has behavior similar to <code>malloc()</code>.</p>
</li>
<li><p class="startli"><code>void (*free)(jas_allocator_t *allocator, void *pointer)</code>;</p>
<p class="startli">This function performs a memory-deallocation operation, and has behavior similar to <code>free()</code>.</p>
</li>
<li><p class="startli"><code>void *(*realloc)(jas_allocator_t *allocator, void *pointer, size_t new_size);</code></p>
<p class="startli">This function performs a memory-reallocation operation, and has behavior similar to <code>realloc()</code>.</p>
</li>
</ul>
<h1><a class="anchor" id="Logging"></a>
Logging</h1>
<p>All error, warning, informational, and debugging messages are normally generated via the logging interface provided by the library. The library user can specify a special function used to generate formatted logging messages. The library user can therefore control where messages are directed. The function has the following signature:</p>
<ul>
<li><p class="startli"><code>int (*vlogprintf)(<a class="el" href="structjas__logtype__t.html" title="Type used for the log type.">jas_logtype_t</a> type, const char *format, va_list ap);</code></p>
<p class="startli">The function formats and outputs a log message. The interface of this function is somewhat similar to vprintf. In addition to a format string and items used for formatting, the function also takes a specification of the type of message being generated (e.g., error, warning, etc.).</p>
</li>
</ul>
<p>This function is used in order to implement functions such as:</p>
<ul>
<li><code><a class="el" href="group__module__log.html#gafd75d5af7e90b2b444238b534907e417" title="Print formatted log message.">jas_vlogmsgf()</a></code></li>
<li><code><a class="el" href="jas__debug_8h.html#a0f93678fe570a64e38702c0c4bdd4f8e" title="Generate a generic log message.">jas_logprintf()</a></code></li>
<li><code><a class="el" href="jas__debug_8h.html#af108fcf470a8d88d7c11195a5508c4d0" title="Generate an error log message.">jas_logerrorf()</a></code></li>
<li><code><a class="el" href="jas__debug_8h.html#a390ec5ca05bc51f5c395a7618cc05560" title="Generate a warning log message.">jas_logwarnf()</a></code></li>
<li><code><a class="el" href="jas__debug_8h.html#a5ad8323a9b65d9e6ade3e17643e090bd" title="Generate an informational log message.">jas_loginfof()</a></code></li>
<li><code><a class="el" href="jas__debug_8h.html#a5aa2035feb05cbb6d8c65af687825117" title="Generate a debugging log message.">jas_logdebugf()</a></code> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__module__init_html_ga3aa0c3964eea8013a1a8b3f43fd0dc05"><div class="ttname"><a href="group__module__init.html#ga3aa0c3964eea8013a1a8b3f43fd0dc05">jas_conf_set_allocator</a></div><div class="ttdeci">JAS_EXPORT void jas_conf_set_allocator(jas_allocator_t *allocator)</div><div class="ttdoc">Set the memory allocator to be used by the library.</div><div class="ttdef"><b>Definition:</b> jas_init.c:425</div></div>
<div class="ttc" id="agroup__module__alloc_html_ga5e90c6c7096fdeeda09e2dcde6c4b4c5"><div class="ttname"><a href="group__module__alloc.html#ga5e90c6c7096fdeeda09e2dcde6c4b4c5">jas_std_allocator_init</a></div><div class="ttdeci">JAS_EXPORT void jas_std_allocator_init(jas_std_allocator_t *allocator)</div><div class="ttdoc">Initialize a memory allocator that uses malloc and related functions for managing memory.</div><div class="ttdef"><b>Definition:</b> jas_malloc.c:262</div></div>
<div class="ttc" id="agroup__module__init_html_ga8358834a376f77d743041d16fc444d68"><div class="ttname"><a href="group__module__init.html#ga8358834a376f77d743041d16fc444d68">jas_conf_set_max_mem_usage</a></div><div class="ttdeci">JAS_EXPORT void jas_conf_set_max_mem_usage(size_t max_mem)</div><div class="ttdoc">Set the maximum amount of memory that can be used by the library (assuming the allocator wrapper is n...</div><div class="ttdef"><b>Definition:</b> jas_init.c:445</div></div>
<div class="ttc" id="agroup__module__init_html_ga9594694b0d16f148affda325971cbd81"><div class="ttname"><a href="group__module__init.html#ga9594694b0d16f148affda325971cbd81">jas_conf_clear</a></div><div class="ttdeci">JAS_EXPORT void jas_conf_clear()</div><div class="ttdoc">Configure the JasPer library with the default configuration settings.</div><div class="ttdef"><b>Definition:</b> jas_init.c:397</div></div>
<div class="ttc" id="astructjas__std__allocator__t_html"><div class="ttname"><a href="structjas__std__allocator__t.html">jas_std_allocator_t</a></div><div class="ttdoc">The standard library allocator (i.e., a wrapper for malloc and friends).</div><div class="ttdef"><b>Definition:</b> jas_malloc.h:143</div></div>
<div class="ttc" id="agroup__module__init_html_ga4115aec35dd0e2105605243215782f36"><div class="ttname"><a href="group__module__init.html#ga4115aec35dd0e2105605243215782f36">jas_conf_set_multithread</a></div><div class="ttdeci">JAS_EXPORT void jas_conf_set_multithread(int multithread)</div><div class="ttdoc">Set the multithreading flag for the library.</div><div class="ttdef"><b>Definition:</b> jas_init.c:419</div></div>
<div class="ttc" id="agroup__module__init_html_ga0cadef06bb0bf90a5f62c65a40aee590"><div class="ttname"><a href="group__module__init.html#ga0cadef06bb0bf90a5f62c65a40aee590">jas_cleanup_library</a></div><div class="ttdeci">JAS_EXPORT int jas_cleanup_library()</div><div class="ttdoc">Perform clean up for the JasPer library.</div><div class="ttdef"><b>Definition:</b> jas_init.c:636</div></div>
<div class="ttc" id="agroup__module__init_html_ga86eb369e542789b63b7af5212fd790de"><div class="ttname"><a href="group__module__init.html#ga86eb369e542789b63b7af5212fd790de">jas_cleanup_thread</a></div><div class="ttdeci">JAS_EXPORT int jas_cleanup_thread()</div><div class="ttdoc">Perform per-thread cleanup for the JasPer library.</div><div class="ttdef"><b>Definition:</b> jas_init.c:757</div></div>
<div class="ttc" id="agroup__module__init_html_gadae9d82f3159eec83b15bcd5e01ff8eb"><div class="ttname"><a href="group__module__init.html#gadae9d82f3159eec83b15bcd5e01ff8eb">jas_init_thread</a></div><div class="ttdeci">JAS_EXPORT int jas_init_thread()</div><div class="ttdoc">Perform per-thread initialization for the JasPer library.</div><div class="ttdef"><b>Definition:</b> jas_init.c:696</div></div>
<div class="ttc" id="agroup__module__init_html_gaefb16e8a208c87feb3de8b29a818f498"><div class="ttname"><a href="group__module__init.html#gaefb16e8a208c87feb3de8b29a818f498">jas_init_library</a></div><div class="ttdeci">JAS_EXPORT int jas_init_library()</div><div class="ttdoc">Initialize the JasPer library with the current configuration settings.</div><div class="ttdef"><b>Definition:</b> jas_init.c:475</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
